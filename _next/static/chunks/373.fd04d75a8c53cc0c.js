"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[373],{71:(e,t,r)=>{r.d(t,{h:()=>n});let a={inferno:"inferno",holliday:"astro",paradox:"chrono",orion:"archer",ghost:"spectre",vindicta:"hornet",seven:"gigawatt",atlas:"bull",forge:"engineer",dynamo:"sumo",calico:"nano",krill:"digger",fathom:"slork",pocket:"synth","the boss":"yakuza",viper:"kali","generic person":"genericperson","lady geist":"spectre","mo and krill":"digger",infernus:"inferno",mcginnis:"engineer","grey talon":"archer",ivy:"tengu",abrams:"bull"};function n(e){let t=e.toLowerCase();return a[t]?a[t]:t.replace(/\s+/g,"")}},3116:(e,t,r)=>{r.d(t,{B2:()=>i,n0:()=>n,tG:()=>l,yV:()=>s});let a="viewedConversations";function n(e){try{let t=o();t.includes(e)||(t.push(e),localStorage.setItem(a,JSON.stringify(t)))}catch(e){console.error("Error marking conversation as viewed:",e)}}function s(e){try{return o().includes(e)}catch(e){return console.error("Error checking if conversation is viewed:",e),!1}}function o(){try{let e=localStorage.getItem(a);return e?JSON.parse(e):[]}catch(e){return console.error("Error getting viewed conversations:",e),[]}}function l(){try{localStorage.removeItem(a)}catch(e){console.error("Error resetting viewed conversations:",e)}}function i(e,t){try{let r=o(),n=t.filter(t=>t.character1===e||t.character2===e).map(e=>e.conversation_id),s=r.filter(e=>!n.includes(e));localStorage.setItem(a,JSON.stringify(s))}catch(e){console.error("Error resetting character viewed conversations:",e)}}},3373:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var a=r(5155),n=r(2115);let s=(0,n.forwardRef)((e,t)=>{let{audioSrc:r,isPlaying:s=!1,onPlayStateChange:o,small:l=!1}=e,[i,c]=(0,n.useState)(s),[d,h]=(0,n.useState)(0),[u,g]=(0,n.useState)(0),v=(0,n.useRef)(null);(0,n.useImperativeHandle)(t,()=>({reset:()=>{v.current&&(v.current.currentTime=0,g(0))}})),(0,n.useEffect)(()=>{c(s)},[s]),(0,n.useEffect)(()=>{v.current&&(i?v.current.play().catch(e=>{console.error("Error playing audio:",e),c(!1),o&&o(!1)}):v.current.pause())},[i,o]);let m=e=>{let t=Math.floor(e/60),r=Math.floor(e%60);return"".concat(t,":").concat(r<10?"0":"").concat(r)};return(0,a.jsxs)("div",{className:"".concat(l?"w-8":"w-full"," flex items-center"),children:[(0,a.jsx)("audio",{ref:v,src:r,onLoadedMetadata:()=>{v.current&&h(v.current.duration)},onTimeUpdate:()=>{v.current&&g(v.current.currentTime)},onEnded:()=>{c(!1),g(0),o&&o(!1)}}),(0,a.jsx)("button",{onClick:()=>{let e=!i;c(e),o&&o(e)},className:"flex-shrink-0 ".concat(l?"w-8 h-8":"w-10 h-10"," rounded-full bg-blue-600 flex items-center justify-center hover:bg-blue-700 focus:outline-none"),"aria-label":i?"Pause":"Play",children:i?(0,a.jsx)("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):(0,a.jsx)("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),!l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex-grow mx-4",children:(0,a.jsx)("input",{type:"range",min:"0",max:d||0,value:u,onChange:e=>{let t=parseFloat(e.target.value);g(t),v.current&&(v.current.currentTime=t)},className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"})}),(0,a.jsxs)("div",{className:"flex-shrink-0 text-sm text-gray-400 w-16 text-right",children:[m(u)," / ",m(d)]})]})]})});s.displayName="AudioPlayer";var o=r(5565),l=r(4957),i=r(71);let c=e=>{let{conversation:t}=e,[r,c]=(0,n.useState)({}),[d,h]=(0,n.useState)(null),[u,g]=(0,n.useState)(!1),[v,m]=(0,n.useState)([]),[x,p]=(0,n.useState)(!1),[f,w]=(0,n.useState)(0),b=(0,n.useRef)(null),j=(0,n.useRef)([]),y=(0,l.v)(t.character1),N=(0,l.v)(t.character2);(0,n.useEffect)(()=>{let e={};t.lines.forEach(t=>{e[t.part]||(e[t.part]=[]),e[t.part].push(t)});let r={};Object.entries(e).forEach(e=>{let[t,a]=e;r[parseInt(t)]=a[0].variation}),c(r)},[t]),(0,n.useEffect)(()=>{m(t.lines.filter(e=>e.variation===r[e.part]).sort((e,t)=>e.part-t.part))},[t,r]),(0,n.useEffect)(()=>{u&&null===d&&v.length>0&&h(0)},[u,d,v]);let C=(e,t)=>{t?h(e):d===e&&(u&&e<v.length-1?h(e+1):(u&&g(!1),h(null)))},k=(e,t)=>{c(r=>({...r,[e]:t}))},S=async(e,t)=>{let r=await fetch(e),a=await r.arrayBuffer();return await t.decodeAudioData(a)},_=async()=>{if(0!==v.length&&!x){p(!0),w(0);try{b.current||(b.current=new(window.AudioContext||window.webkitAudioContext));let e=b.current,r=[];for(let t=0;t<v.length;t++){let a=v[t],n="/audioFiles/".concat(a.filename);try{let t=await S(n,e);r.push(t)}catch(e){console.error("Error loading audio for line ".concat(t,":"),e)}w(Math.round((t+1)/v.length*100))}let a=r.reduce((e,t)=>e+t.duration,0),n=e.createBuffer(r[0].numberOfChannels,e.sampleRate*a,e.sampleRate),s=0;for(let t of r){for(let r=0;r<t.numberOfChannels;r++){let a=t.getChannelData(r);n.copyToChannel(a,r,Math.floor(s*e.sampleRate))}s+=t.duration}let o=I(n,e.sampleRate),l=URL.createObjectURL(o),i=document.createElement("a");i.href=l,i.download="".concat(t.character1,"_").concat(t.character2,"_conversation.wav"),i.click(),URL.revokeObjectURL(l),p(!1),w(0)}catch(e){console.error("Error generating download:",e),p(!1),w(0),alert("Error generating download. Please try again.")}}},I=(e,t)=>{let r=e.numberOfChannels,a=e.length*r*2,n=new ArrayBuffer(44+a),s=new DataView(n);L(s,0,"RIFF"),s.setUint32(4,36+a,!0),L(s,8,"WAVE"),L(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,r,!0),s.setUint32(24,t,!0),s.setUint32(28,t*r*2,!0),s.setUint16(32,2*r,!0),s.setUint16(34,16,!0),L(s,36,"data"),s.setUint32(40,a,!0);let o=44;for(let t=0;t<e.length;t++)for(let a=0;a<r;a++){let r=Math.max(-1,Math.min(1,e.getChannelData(a)[t])),n=r<0?32768*r:32767*r;s.setInt16(o,n,!0),o+=2}return new Blob([n],{type:"audio/wav"})},L=(e,t,r)=>{for(let a=0;a<r.length;a++)e.setUint8(t+a,r.charCodeAt(a))},P={};t.lines.forEach(e=>{P[e.part]||(P[e.part]=[]),P[e.part].push(e)});let R=Object.values(P).some(e=>e.length>1),E=e=>{let t=(0,i.h)(e);return"/minimapIcons/".concat(t,"_mm_psd.png")};return(0,n.useEffect)(()=>{j.current=Array(v.length).fill(null)},[v.length]),(0,a.jsxs)("div",{className:"bg-gray-900 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap justify-between items-center mb-6 gap-2",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-white",children:["Conversation: ",y," & ",N]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{u?(g(!1),h(null)):(g(!0),h(0),j.current.forEach(e=>{e&&e.reset()}))},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none flex items-center",children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Stop Playing"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})}),"Play All"]})}),(0,a.jsx)("button",{onClick:_,disabled:x||0===v.length,className:"px-4 py-2 rounded-lg focus:outline-none flex items-center ".concat(x||0===v.length?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),f,"%"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Download"]})})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[!t.is_complete&&(0,a.jsx)("span",{className:"px-3 py-1 bg-yellow-800 text-yellow-100 rounded-full text-sm",children:"Incomplete Conversation"}),t.missing_parts.length>0&&(0,a.jsxs)("span",{className:"px-3 py-1 bg-red-800 text-red-100 rounded-full text-sm",children:["Missing Parts: ",t.missing_parts.join(", ")]})]}),R&&(0,a.jsxs)("div",{className:"mb-6 bg-gray-800 p-4 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"Select Variations"}),(0,a.jsx)("div",{className:"space-y-3",children:Object.entries(P).map(e=>{let[t,s]=e;return(0,a.jsx)(n.Fragment,{children:s.length>1&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("span",{className:"text-gray-300 w-24",children:["Part ",t,":"]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map(e=>(0,a.jsxs)("button",{onClick:()=>k(e.part,e.variation),className:"px-3 py-1 rounded-full text-sm ".concat(r[e.part]===e.variation?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:["Variation ",e.variation]},"var-btn-".concat(e.part,"-").concat(e.variation)))})]},"part-".concat(t))},"part-container-".concat(t))})})]}),(0,a.jsx)("div",{className:"space-y-4 max-w-2xl mx-auto",children:v.map((e,r)=>{let n=(0,l.v)(e.speaker);return(0,a.jsx)("div",{className:"flex ".concat(e.speaker===t.character1?"justify-start":"justify-end"),children:(0,a.jsxs)("div",{className:"flex max-w-[80%] ".concat(e.speaker===t.character1?"flex-row":"flex-row-reverse"),children:[(0,a.jsx)("div",{className:"flex-shrink-0 mx-2",children:(0,a.jsx)("div",{className:"relative w-10 h-10",children:(0,a.jsx)(o.default,{src:E(e.speaker),alt:"".concat(n," portrait"),fill:!0,sizes:"40px",className:"object-cover rounded-full",onError:e=>{e.target.src="/minimapIcons/genericperson_mm_psd.png"}})})}),(0,a.jsxs)("div",{className:"rounded-lg p-3 ".concat(e.speaker===t.character1?"bg-blue-800 rounded-tl-none":"bg-green-800 rounded-tr-none"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)("span",{className:"font-semibold text-white",children:n}),(0,a.jsxs)("span",{className:"text-xs text-gray-300 ml-2",children:["Part ",e.part]})]}),(0,a.jsx)("p",{className:"text-white mb-2",children:e.transcription}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(s,{ref:e=>{j.current[r]=e},audioSrc:"/audioFiles/".concat(e.filename),isPlaying:d===r,onPlayStateChange:e=>C(r,e)})})]})]})},"line-".concat(e.part,"-").concat(e.variation,"-").concat(r))})}),t.missing_parts.map(e=>(0,a.jsx)("div",{className:"my-4 p-3 bg-red-900/30 border border-red-800 rounded-lg text-center",children:(0,a.jsxs)("p",{className:"text-red-300",children:[(0,a.jsx)("svg",{className:"w-5 h-5 inline-block mr-1",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Missing dialogue part ",e]})},"missing-".concat(e)))]})};var d=r(8173),h=r.n(d),u=r(6046),g=r(9895),v=r(3116);let m="previousPath";function x(e){let{conversation:t}=e,r=(0,u.useRouter)(),s=(0,u.usePathname)(),[o,i]=(0,n.useState)("/conversations"),{data:d}=(0,g.E)(),[x,p]=(0,n.useState)([]),[f,w]=(0,n.useState)([]),[b,j]=(0,n.useState)([]),[y,N]=(0,n.useState)(0),[C,k]=(0,n.useState)(0),[S,_]=(0,n.useState)(0),[I,L]=(0,n.useState)([]),[P,R]=(0,n.useState)(null),[E,M]=(0,n.useState)(null),[B,A]=(0,n.useState)(null),[F,z]=(0,n.useState)(null),[O,T]=(0,n.useState)([]),[U,V]=(0,n.useState)(0),[W,J]=(0,n.useState)(!1),G=(0,l.v)(t.character1),D=(0,l.v)(t.character2);(0,n.useEffect)(()=>{{let e=sessionStorage.getItem(m),t=sessionStorage.getItem("selectedPartners"),r=sessionStorage.getItem("searchTerm"),a=sessionStorage.getItem("characterFilter"),n=sessionStorage.getItem("completenessFilter"),o=sessionStorage.getItem("navigationState"),l=sessionStorage.getItem("originalSourcePath");if(console.log("Previous path:",e),!e||e.includes("/conversations/")&&l||(sessionStorage.setItem("originalSourcePath",e),console.log("Setting original source path:",e)),o)try{let t=JSON.parse(o);e&&e.includes("/characters/")?(J(!1),M(null),A(null),z(null)):(t.comingFromAllConversations&&J(!0),t.searchTerm&&M(t.searchTerm),t.characterFilter&&A(t.characterFilter),t.completenessFilter&&z(t.completenessFilter))}catch(e){console.error("Error parsing navigation state:",e)}if(e&&e!==s){if(i(e),e.includes("/characters/")){let r=e.split("/characters/")[1];if(r&&(R(decodeURIComponent(r.split("/")[0].split("?")[0])),M(null),A(null),z(null),J(!1),t))try{let e=JSON.parse(t);Array.isArray(e)&&L(e)}catch(e){console.error("Error parsing selected partners:",e)}}("/conversations"===e||e.startsWith("/conversations?"))&&(console.log("Coming from all conversations page"),R(null),L([]),J(!0),r&&M(r),a&&A(a),n&&z(n),console.log("Restored from session storage:",{searchTerm:r,characterFilter:a,completenessFilter:n}))}sessionStorage.setItem(m,s);let c=()=>{sessionStorage.setItem(m,s),(W||E||B||F)&&sessionStorage.setItem("navigationState",JSON.stringify({comingFromAllConversations:W,searchTerm:E,characterFilter:B,completenessFilter:F}))};return window.addEventListener("beforeunload",c),()=>{window.removeEventListener("beforeunload",c)}}},[s,W,E,B,F]),(0,n.useEffect)(()=>{if(d&&t){if("true"===sessionStorage.getItem("preserveNavigationState")){sessionStorage.removeItem("preserveNavigationState"),console.log("Preserving navigation state");let e=sessionStorage.getItem("navigationState");if(e)try{let r=JSON.parse(e);if(r.showSearchNavigation&&(M(r.searchTerm||E),A(r.characterFilter||B),z(r.completenessFilter||F)),r.showAllConversationsNavigation&&J(!0),r.showCharacterNavigation&&r.sourceCharacter&&(R(r.sourceCharacter),r.selectedPartners&&L(r.selectedPartners)),r.showNavigation,r.searchResults&&Array.isArray(r.searchResults)){let e=d.conversations.filter(e=>r.searchResults.includes(e.conversation_id)),a=[];for(let t of r.searchResults){let r=e.find(e=>e.conversation_id===t);r&&a.push(r)}if(a.length>0){j(a);let e=a.findIndex(e=>e.conversation_id===t.conversation_id);-1!==e&&_(e)}}if(r.characterConversations&&Array.isArray(r.characterConversations)){let e=d.conversations.filter(e=>r.characterConversations.includes(e.conversation_id)),a=[];for(let t of r.characterConversations){let r=e.find(e=>e.conversation_id===t);r&&a.push(r)}if(a.length>0){w(a);let e=a.findIndex(e=>e.conversation_id===t.conversation_id);-1!==e&&k(e)}}if(r.relatedConversations&&Array.isArray(r.relatedConversations)){let e=d.conversations.filter(e=>r.relatedConversations.includes(e.conversation_id)),a=[];for(let t of r.relatedConversations){let r=e.find(e=>e.conversation_id===t);r&&a.push(r)}if(a.length>0){p(a);let e=a.findIndex(e=>e.conversation_id===t.conversation_id);-1!==e&&N(e)}}}catch(e){console.error("Error parsing navigation state:",e)}let r=d.conversations.findIndex(e=>e.conversation_id===t.conversation_id);if(-1!==r&&V(r),(E&&""!==E.trim()||B&&"all"!==B||F&&"all"!==F)&&(!b||0===b.length)){let e=[...d.conversations];if(E&&""!==E.trim()){let t=E.toLowerCase();e=e.filter(e=>e.lines.some(e=>e.transcription.toLowerCase().includes(t))||e.summary.toLowerCase().includes(t)||e.character1.toLowerCase().includes(t)||e.character2.toLowerCase().includes(t))}if(B&&"all"!==B&&(e=e.filter(e=>e.character1===B||e.character2===B)),F&&"all"!==F){let t="complete"===F;e=e.filter(e=>e.is_complete===t)}let r=e.findIndex(e=>e.conversation_id===t.conversation_id);-1!==r&&(j(e),_(r))}return}console.log("Setting up navigation with data:",{comingFromAllConversations:W,sourceCharacter:P,searchTerm:E,characterFilter:B,completenessFilter:F});let e=[...d.conversations].sort((e,t)=>e.conversation_id.localeCompare(t.conversation_id));T(e);let r=e.findIndex(e=>e.conversation_id===t.conversation_id);-1!==r&&V(r);let a=d.conversations.filter(e=>e.character1===t.character1&&e.character2===t.character2||e.character1===t.character2&&e.character2===t.character1).sort((e,t)=>e.conversation_id.localeCompare(t.conversation_id));p(a);let n=a.findIndex(e=>e.conversation_id===t.conversation_id);if(-1!==n&&N(n),P&&I.length>0){let e=d.conversations.filter(e=>{if(e.character1!==P&&e.character2!==P)return!1;let t=e.character1===P?e.character2:e.character1;return I.includes(t)}).sort((e,t)=>e.conversation_id.localeCompare(t.conversation_id));w(e);let r=e.findIndex(e=>e.conversation_id===t.conversation_id);-1!==r&&k(r)}else if(P&&!I.length){let e=d.conversations.filter(e=>e.character1===P||e.character2===P).sort((e,t)=>e.conversation_id.localeCompare(t.conversation_id));w(e);let r=e.findIndex(e=>e.conversation_id===t.conversation_id);-1!==r&&k(r)}if(E&&""!==E.trim()||B&&"all"!==B||F&&"all"!==F){let e=[...d.conversations];if(E&&""!==E.trim()){let t=E.toLowerCase();e=e.filter(e=>e.lines.some(e=>e.transcription.toLowerCase().includes(t))||e.summary.toLowerCase().includes(t)||e.character1.toLowerCase().includes(t)||e.character2.toLowerCase().includes(t))}if(B&&"all"!==B&&(e=e.filter(e=>e.character1===B||e.character2===B)),F&&"all"!==F){let t="complete"===F;e=e.filter(e=>e.is_complete===t)}j(e);let r=e.findIndex(e=>e.conversation_id===t.conversation_id);-1!==r&&_(r)}}},[d,t,P,I,E,B,F,W]),(0,n.useEffect)(()=>{t&&(0,v.n0)(t.conversation_id)},[t]);let H=e=>{if(sessionStorage.setItem("preserveNavigationState","true"),P){let t={sourceCharacter:P,selectedPartners:I,showCharacterNavigation:!0,characterConversations:f.map(e=>e.conversation_id),characterIndex:f.findIndex(t=>t.conversation_id===e),comingFromAllConversations:!1,searchTerm:null,characterFilter:null,completenessFilter:null};sessionStorage.setItem("navigationState",JSON.stringify(t))}else if(W||E||B||F){let t={comingFromAllConversations:!0,sourceCharacter:null,selectedPartners:[]};t=E&&""!==E.trim()||B&&"all"!==B||F&&"all"!==F?{...t,searchTerm:E,characterFilter:B,completenessFilter:F,showSearchNavigation:!0,showAllConversationsNavigation:!1,searchResults:b.map(e=>e.conversation_id),searchIndex:b.findIndex(t=>t.conversation_id===e)}:{...t,showSearchNavigation:!1,showAllConversationsNavigation:!0,allConversations:O.map(e=>e.conversation_id),allConversationsIndex:O.findIndex(t=>t.conversation_id===e)},sessionStorage.setItem("navigationState",JSON.stringify(t))}else{let t={showNavigation:!0,relatedConversations:x.map(e=>e.conversation_id),currentIndex:x.findIndex(t=>t.conversation_id===e)};sessionStorage.setItem("navigationState",JSON.stringify(t))}r.push("/conversations/".concat(e))},K=x.length>1,q=P&&f.length>1,Y=E&&""!==E.trim()||B&&"all"!==B||F&&"all"!==F,Q=b.length>1&&Y,X=O.length>1&&W&&!Y;(0,n.useEffect)(()=>{{let e={comingFromAllConversations:W,sourceCharacter:P,searchTerm:E,characterFilter:B,completenessFilter:F,showAllConversationsNavigation:X,showSearchNavigation:Q,showCharacterNavigation:q,showNavigation:K,searchResults:b.map(e=>e.conversation_id),searchIndex:S,allConversations:O.map(e=>e.conversation_id),allConversationsIndex:U,characterConversations:f.map(e=>e.conversation_id),characterIndex:C,relatedConversations:x.map(e=>e.conversation_id),currentIndex:y};sessionStorage.setItem("navigationState",JSON.stringify(e))}},[W,P,E,B,F,X,Q,q,K,b,S,O,U,f,C,x,y]),(0,n.useEffect)(()=>{console.log("Navigation state:",{comingFromAllConversations:W,sourceCharacter:P,searchTerm:E,characterFilter:B,completenessFilter:F,showAllConversationsNavigation:X,showSearchNavigation:Q,showCharacterNavigation:q,showNavigation:K,allConversationsLength:O.length,searchResultsLength:b.length,characterConversationsLength:f.length,relatedConversationsLength:x.length})},[W,P,E,B,F,X,Q,q,K,O.length,b.length,f.length,x.length]);let Z=P?(0,l.v)(P):"";return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,a.jsxs)("button",{onClick:()=>{let e=sessionStorage.getItem("originalSourcePath");e&&e!==s?r.push(e):window.history.back()},className:"inline-flex items-center text-blue-400 hover:underline bg-transparent border-none cursor-pointer",children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),(()=>{if(o.includes("/characters/")){let e=o.split("/characters/")[1];if(e){let t=e.split("/")[0].split("?")[0];if(t)return"Back to ".concat((0,l.v)(decodeURIComponent(t)),"'s Profile")}}return"/conversations"===o||o.startsWith("/conversations?")?E?"Back to Search Results":"Back to All Conversations":"/"===o||""===o?"Back to Home":"Back"})()]}),Q&&(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-gray-400",children:["Search Result ",S+1," of ",b.length,E&&(0,a.jsxs)("span",{className:"ml-1",children:['"',E,'"']})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{if(S>0){let e=b[S-1];console.log("Navigating to previous search result:",e.conversation_id),H(e.conversation_id)}},disabled:0===S,className:"p-2 rounded-full ".concat(0===S?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),"aria-label":"Previous search result",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("button",{onClick:()=>{if(S<b.length-1){let e=b[S+1];console.log("Navigating to next search result:",e.conversation_id),H(e.conversation_id)}},disabled:S===b.length-1,className:"p-2 rounded-full ".concat(S===b.length-1?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),"aria-label":"Next search result",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})]}),!Q&&q&&(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-gray-400",children:[0===I.length?"".concat(Z,"'s Conversation"):1===I.length?"".concat(Z,"'s Conversation with ").concat((0,l.v)(I[0])):"".concat(Z,"'s Filtered Conversations")," ",C+1," of ",f.length]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{if(C>0){let e=f[C-1];console.log("Navigating to previous character conversation:",e.conversation_id),H(e.conversation_id)}},disabled:0===C,className:"p-2 rounded-full ".concat(0===C?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),"aria-label":"Previous conversation",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("button",{onClick:()=>{if(C<f.length-1){let e=f[C+1];console.log("Navigating to next character conversation:",e.conversation_id),H(e.conversation_id)}},disabled:C===f.length-1,className:"p-2 rounded-full ".concat(C===f.length-1?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),"aria-label":"Next conversation",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})]}),!Q&&!q&&X&&(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-gray-400",children:["All Conversations ",U+1," of ",O.length]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{if(U>0){let e=O[U-1];console.log("Navigating to previous all conversation:",e.conversation_id),H(e.conversation_id)}},disabled:0===U,className:"p-2 rounded-full ".concat(0===U?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),"aria-label":"Previous conversation",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("button",{onClick:()=>{if(U<O.length-1){let e=O[U+1];console.log("Navigating to next all conversation:",e.conversation_id),H(e.conversation_id)}},disabled:U===O.length-1,className:"p-2 rounded-full ".concat(U===O.length-1?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),"aria-label":"Next conversation",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})]}),!Q&&!q&&!X&&K&&(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-gray-400",children:["Conversation ",y+1," of ",x.length]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{if(y>0){let e=x[y-1];console.log("Navigating to previous related conversation:",e.conversation_id),H(e.conversation_id)}},disabled:0===y,className:"p-2 rounded-full ".concat(0===y?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),"aria-label":"Previous conversation",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("button",{onClick:()=>{if(y<x.length-1){let e=x[y+1];console.log("Navigating to next related conversation:",e.conversation_id),H(e.conversation_id)}},disabled:y===x.length-1,className:"p-2 rounded-full ".concat(y===x.length-1?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),"aria-label":"Next conversation",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})]})]}),(0,a.jsx)(c,{conversation:t}),(0,a.jsxs)("div",{className:"mt-8 flex gap-4",children:[(0,a.jsxs)(h(),{href:"/characters/".concat(t.character1),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white",children:["View ",G,"'s Profile"]}),(0,a.jsxs)(h(),{href:"/characters/".concat(t.character2),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white",children:["View ",D,"'s Profile"]})]}),K&&(0,a.jsxs)("div",{className:"mt-6 bg-gray-800 p-4 rounded-lg",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-white mb-3",children:["More conversations between ",G," and ",D]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map((e,r)=>(0,a.jsxs)("div",{className:"p-3 rounded-lg cursor-pointer ".concat(e.conversation_id===t.conversation_id?"bg-blue-900 border border-blue-700":"bg-gray-700 hover:bg-gray-600"),onClick:()=>{e.conversation_id!==t.conversation_id&&H(e.conversation_id)},children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("span",{className:"font-medium text-white",children:["Conversation ",r+1]}),!e.is_complete&&(0,a.jsx)("span",{className:"px-2 py-0.5 bg-yellow-800 text-yellow-100 rounded-full text-xs",children:"Incomplete"})]}),(0,a.jsx)("p",{className:"text-gray-300 text-sm mt-1 line-clamp-2",children:e.summary||(e.lines.length>0?e.lines[0].transcription:"No preview available")})]},e.conversation_id))})]}),P&&(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:[(0,l.v)(P),"'s conversations",I.length>0&&(0,a.jsx)("span",{children:" with selected partners"})]}),P&&(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:[(0,l.v)(P),"'s complete conversations"]})]})}},4957:(e,t,r)=>{r.d(t,{v:()=>n});let a={inferno:"Infernus",gigawatt:"Seven",hornet:"Vindicta",ghost:"Lady Geist",tempest:"Tempest",atlas:"Abrams",wraith:"Wraith",forge:"McGinnis",chrono:"Paradox",sumo:"Dynamo",kelvin:"Kelvin",haze:"Haze",astro:"Holliday",bebop:"Bebop",nano:"Calico",orion:"Grey Talon",krill:"Mo and Krill",shiv:"Shiv",tengu:"Ivy",kali:"Kali",warden:"Warden",yamato:"Yamato",butcher:"Butcher",lash:"Lash",akimbo:"Akimbo",viscous:"Viscous",ballista:"Ballista",gunslinger:"Gunslinger",yakuza:"The Boss",spade:"Spade",genericperson:"Generic Person",tokamak:"Tokamak",wrecker:"Wrecker",rutger:"Rutger",synth:"Pocket",thumper:"Thumper",mirage:"Mirage",slork:"Fathom",cadence:"Cadence",targetdummy:"Target Dummy",bomber:"Bomber",viper:"Vyper","generic person":"Generic Person",generic:"Generic Person",mo:"Mo and Krill","the boss":"The Boss","grey talon":"Grey Talon","lady geist":"Lady Geist"};function n(e){return a[e.toLowerCase()]?a[e.toLowerCase()]:e.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}},6046:(e,t,r)=>{var a=r(6658);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},9895:(e,t,r)=>{r.d(t,{DataProvider:()=>i,E:()=>l});var a=r(5155),n=r(2115),s=r(6895);let o=(0,n.createContext)({data:null,characters:[],loading:!0,error:null}),l=()=>(0,n.useContext)(o),i=e=>{let{children:t}=e,[r,l]=(0,n.useState)(null),[i,c]=(0,n.useState)([]),[d,h]=(0,n.useState)(!0),[u,g]=(0,n.useState)(null);return(0,n.useEffect)(()=>{(async()=>{try{h(!0);let e=await (0,s.Mq)();l(e),c((0,s.w)(e)),g(null)}catch(e){console.error("Error loading data:",e),g("Failed to load conversation data. Please try again later.")}finally{h(!1)}})()},[]),(0,a.jsx)(o.Provider,{value:{data:r,characters:i,loading:d,error:u},children:t})}}}]);