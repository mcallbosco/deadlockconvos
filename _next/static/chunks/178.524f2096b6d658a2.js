"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{3116:(e,t,r)=>{r.d(t,{B2:()=>c,n0:()=>s,tG:()=>a,yV:()=>l});let n="viewedConversations";function s(e){try{let t=o();t.includes(e)||(t.push(e),localStorage.setItem(n,JSON.stringify(t)))}catch(e){console.error("Error marking conversation as viewed:",e)}}function l(e){try{return o().includes(e)}catch(e){return console.error("Error checking if conversation is viewed:",e),!1}}function o(){try{let e=localStorage.getItem(n);return e?JSON.parse(e):[]}catch(e){return console.error("Error getting viewed conversations:",e),[]}}function a(){try{localStorage.removeItem(n)}catch(e){console.error("Error resetting viewed conversations:",e)}}function c(e,t){try{let r=o(),s=t.filter(t=>t.character1===e||t.character2===e).map(e=>e.conversation_id),l=r.filter(e=>!s.includes(e));localStorage.setItem(n,JSON.stringify(l))}catch(e){console.error("Error resetting character viewed conversations:",e)}}},6046:(e,t,r)=>{var n=r(6658);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},6178:(e,t,r)=>{r.r(t),r.d(t,{default:()=>S});var n=r(5155),s=r(2115),l=r(9232),o=r(9895),a=r(6895),c=r(4874),i=r(4957);let d=e=>{let{voiceLines:t,selectedCategory:r,currentPlayingFile:l=null,onVoiceLinePlayed:o=()=>{},onVoiceLinePaused:a=()=>{},expandAll:d=!1,characterName:u,isPlayingAll:h=!1,currentPlayingCharacter:m=null,currentPlayingCategory:g=null,onPlayCharacter:f=()=>{},onPlayCategory:x=()=>{}}=e,[b,y]=(0,s.useState)(new Set),[v,p]=(0,s.useState)(new Set),[j,N]=(0,s.useState)(!1),w={},S={};Object.entries(t).forEach(e=>{let[t,r]=e;"self"===t.toLowerCase()?w[t]=r:S[t]=r});let k={},E={};Object.entries(w).forEach(e=>{let[t,n]=e;r?n[r]&&(k[t]={[r]:n[r]}):k[t]=n}),Object.entries(S).forEach(e=>{let[t,n]=e;r?n[r]&&(E[t]={[r]:n[r]}):E[t]=n});let L={...k,...E};if((0,s.useEffect)(()=>{console.log("VoiceLinesAbout - voiceLines keys:",Object.keys(t)),console.log("VoiceLinesAbout - selfVoiceLines keys:",Object.keys(w)),console.log("VoiceLinesAbout - otherVoiceLines keys:",Object.keys(S)),console.log("VoiceLinesAbout - filteredSelfVoiceLines keys:",Object.keys(k)),console.log("VoiceLinesAbout - filteredOtherVoiceLines keys:",Object.keys(E))},[t,w,S,k,E]),(0,s.useEffect)(()=>{if(d&&!j){y(new Set(Object.keys(L)));let e=new Set;Object.values(L).forEach(t=>{Object.keys(t).forEach(t=>{e.add(t)})}),p(e),N(!0)}},[d,j,L]),(0,s.useEffect)(()=>{if(m){let e=b.has(m),t=new Set;L[m]&&Object.keys(L[m]).forEach(e=>{t.add(e)});let r=Array.from(t).every(e=>v.has(e));if((!e||!r)&&(e||y(new Set([m])),!r)){let e=new Set(v);t.forEach(t=>{e.add(t)}),p(e)}}},[m,L,b,v]),r&&0===Object.keys(L).length)return(0,n.jsxs)("div",{className:"text-center py-8 text-gray-400",children:['No voice lines found in the "',r,'" category.']});let C=e=>{let t=new Set(b);t.has(e)?t.delete(e):t.add(e),y(t),N(t.size===Object.keys(L).length)},O=e=>{let t=new Set(v);t.has(e)?t.delete(e):t.add(e),p(t)},A=e=>{o(e)},V=e=>{a(e)},P=e=>{f(e)},I=(e,t)=>{x(e,t)},F=(e,t)=>(0,n.jsxs)("div",{className:"border rounded-lg p-4 mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("button",{className:"text-left font-medium text-lg flex items-center",onClick:()=>C(e),children:[(0,n.jsx)("span",{children:e}),(0,n.jsx)("span",{className:"ml-2",children:b.has(e)?"−":"+"})]}),(0,n.jsx)("button",{onClick:()=>P(e),className:"px-3 py-1 rounded text-white text-sm ".concat(h&&m===e&&!g?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"),children:h&&m===e&&!g?"Stop Playing":"Play All"})]}),b.has(e)&&(0,n.jsx)("div",{className:"mt-4 space-y-4",children:Object.entries(t).map(t=>{let[r,s]=t;return(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("button",{className:"text-left font-medium flex items-center",onClick:()=>O(r),children:[(0,n.jsx)("span",{children:r}),(0,n.jsx)("span",{className:"ml-2",children:v.has(r)?"−":"+"})]}),(0,n.jsx)("button",{onClick:()=>I(e,r),className:"px-3 py-1 rounded text-white text-xs ".concat(h&&m===e&&g===r?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"),children:h&&m===e&&g===r?"Stop":"Play"})]}),v.has(r)&&(0,n.jsx)("div",{className:"mt-2 space-y-2",children:Array.isArray(s)?s.map(e=>(0,n.jsx)(c.A,{filename:e.filename,transcription:e.transcription,externalIsPlaying:l===e.filename,onPlay:A,onPause:V},e.voiceline_id)):Object.entries(s).map(e=>{let[t,r]=e;return(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsx)("h4",{className:"font-medium",children:t}),(0,n.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,n.jsx)(c.A,{filename:e.filename,transcription:e.transcription,externalIsPlaying:l===e.filename,onPlay:A,onPause:V},e.voiceline_id))})]},t)})})]},r)})})]},e);return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsxs)("h2",{className:"text-lg font-semibold text-white",children:["Voice Lines Spoken By ",(0,i.v)(u)]}),(0,n.jsx)("button",{onClick:()=>{if(j)y(new Set),p(new Set),N(!1);else{y(new Set(Object.keys(L)));let e=new Set;Object.values(L).forEach(t=>{Object.keys(t).forEach(t=>{e.add(t)})}),p(e),N(!0)}},className:"px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",children:j?"Collapse All":"Expand All"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[Object.keys(k).length>0&&(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-blue-400 mb-4",children:"Voice Lines About Self"}),Object.entries(k).map(e=>{let[t,r]=e;return F(t,r)})]}),Object.keys(E).length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-blue-400 mb-4",children:"Voice Lines About Others"}),Object.entries(E).map(e=>{let[t,r]=e;return F(t,r)})]}),0===Object.keys(L).length&&(0,n.jsxs)("div",{className:"text-center py-8 text-gray-400",children:["No voice lines found for ",(0,i.v)(u),r?' in the "'.concat(r,'" category'):""]})]})]})},u=e=>{let{voiceLines:t,characterName:r,selectedCategory:l,currentPlayingFile:o=null,onVoiceLinePlayed:a=()=>{},onVoiceLinePaused:d=()=>{},expandAll:u=!1,isPlayingAll:h=!1,currentPlayingCharacter:m=null,currentPlayingCategory:g=null,onPlayCharacter:f=()=>{},onPlayCategory:x=()=>{}}=e,[b,y]=(0,s.useState)(new Set),[v,p]=(0,s.useState)(new Set),[j,N]=(0,s.useState)(!1);if(0===Object.keys(t).length)return(0,n.jsxs)("div",{className:"text-center py-8 text-gray-400",children:["No voice lines about ",(0,i.v)(r)," from other characters."]});let w={};if(Object.entries(t).forEach(e=>{let[t,r]=e;l?r[l]&&(w[t]={[l]:r[l]}):w[t]=r}),l&&0===Object.keys(w).length)return(0,n.jsxs)("div",{className:"text-center py-8 text-gray-400",children:['No voice lines found in the "',l,'" category.']});(0,s.useEffect)(()=>{if(u&&!j){y(new Set(Object.keys(w)));let e=new Set;Object.values(w).forEach(t=>{Object.keys(t).forEach(t=>{e.add(t)})}),p(e),N(!0)}},[u,j,w]),(0,s.useEffect)(()=>{if(m){let e=b.has(m),t=new Set;w[m]&&Object.keys(w[m]).forEach(e=>{t.add(e)});let r=Array.from(t).every(e=>v.has(e));if((!e||!r)&&(e||y(new Set([m])),!r)){let e=new Set(v);t.forEach(t=>{e.add(t)}),p(e)}}},[m,w,b,v]);let S=e=>{let t=new Set(b);t.has(e)?t.delete(e):t.add(e),y(t),N(t.size===Object.keys(w).length)},k=e=>{let t=new Set(v);t.has(e)?t.delete(e):t.add(e),p(t)},E=e=>{a(e)},L=e=>{d(e)},C=e=>{f(e)},O=(e,t)=>{x(e,t)};return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsxs)("h2",{className:"text-lg font-semibold text-white",children:["Lines About ",(0,i.v)(r)]}),(0,n.jsx)("button",{onClick:()=>{if(j)y(new Set),p(new Set),N(!1);else{y(new Set(Object.keys(w)));let e=new Set;Object.values(w).forEach(t=>{Object.keys(t).forEach(t=>{e.add(t)})}),p(e),N(!0)}},className:"px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",children:j?"Collapse All":"Expand All"})]}),(0,n.jsx)("div",{className:"space-y-4",children:Object.entries(w).map(e=>{let[t,r]=e;return(0,n.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("button",{className:"text-left font-medium text-lg flex items-center",onClick:()=>S(t),children:[(0,n.jsx)("span",{children:t}),(0,n.jsx)("span",{className:"ml-2",children:b.has(t)?"−":"+"})]}),(0,n.jsx)("button",{onClick:()=>C(t),className:"px-3 py-1 rounded text-white text-sm ".concat(h&&m===t&&!g?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"),children:h&&m===t&&!g?"Stop Playing":"Play All"})]}),b.has(t)&&(0,n.jsx)("div",{className:"mt-4 space-y-4",children:Object.entries(r).map(e=>{let[r,s]=e;return(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("button",{className:"text-left font-medium flex items-center",onClick:()=>k(r),children:[(0,n.jsx)("span",{children:r}),(0,n.jsx)("span",{className:"ml-2",children:v.has(r)?"−":"+"})]}),(0,n.jsx)("button",{onClick:()=>O(t,r),className:"px-3 py-1 rounded text-white text-xs ".concat(h&&m===t&&g===r?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"),children:h&&m===t&&g===r?"Stop":"Play"})]}),v.has(r)&&(0,n.jsx)("div",{className:"mt-2 space-y-2",children:Array.isArray(s)?s.map(e=>(0,n.jsx)(c.A,{filename:e.filename,transcription:e.transcription,externalIsPlaying:o===e.filename,onPlay:E,onPause:L},e.voiceline_id)):Object.entries(s).map(e=>{let[t,r]=e;return(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsx)("h4",{className:"font-medium",children:t}),(0,n.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,n.jsx)(c.A,{filename:e.filename,transcription:e.transcription,externalIsPlaying:o===e.filename,onPlay:E,onPause:L},e.voiceline_id))})]},t)})})]},r)})})]},t)})})]})},h=e=>{let{characterName:t}=e,{voiceLines:r,loading:l,error:c}=(0,o.E)(),[h,m]=(0,s.useState)("about"),[g,f]=(0,s.useState)([]),[x,b]=(0,s.useState)(!1),[y,v]=(0,s.useState)([]),[p,j]=(0,s.useState)(null),[N,w]=(0,s.useState)(null),S=(0,s.useRef)(null),k=(0,s.useRef)(0),E=(0,s.useRef)([]),[L,C]=(0,s.useState)(null),[O,A]=(0,s.useState)(!1),V=(0,s.useRef)(y),P=(0,s.useRef)(g),I=(0,s.useRef)(x);if((0,s.useEffect)(()=>()=>{console.log("VoiceLinesSection - Cleaning up audio resources"),S.current&&(S.current.pause(),S.current.src="",S.current=null),I.current=!1,b(!1),C(null)},[]),(0,s.useEffect)(()=>{console.log("VoiceLinesSection - voiceLines data:",r?"available":"not available"),r&&console.log("VoiceLinesSection - voiceLines keys:",Object.keys(r))},[r]),(0,s.useEffect)(()=>{V.current=y},[y]),(0,s.useEffect)(()=>{P.current=g},[g]),(0,s.useEffect)(()=>{I.current=x,console.log("isPlayingAll state changed to:",x)},[x]),(0,s.useEffect)(()=>{{let e=()=>{console.log("VoiceLinesSection - Loading filters from session storage");let e=sessionStorage.getItem("voiceLineFilterTab");e&&(console.log("VoiceLinesSection - Loading saved tab:",e),m(e));let t=sessionStorage.getItem("voiceLineFilterCharacters");if(t)try{let e=JSON.parse(t);Array.isArray(e)&&(console.log("VoiceLinesSection - Loading saved characters:",e),JSON.stringify(e)!==JSON.stringify(V.current)&&v(e))}catch(e){console.error("Error parsing saved voice line filter characters:",e),V.current.length>0&&v([])}else V.current.length>0&&v([]);let r=sessionStorage.getItem("voiceLineFilterCategories");if(r)try{let e=JSON.parse(r);Array.isArray(e)&&(console.log("VoiceLinesSection - Loading saved categories:",e),JSON.stringify(e)!==JSON.stringify(P.current)&&f(e))}catch(e){console.error("Error parsing saved voice line filter categories:",e),P.current.length>0&&f([])}else P.current.length>0&&f([])};e();let t=()=>{console.log("VoiceLinesSection - Filter change detected"),setTimeout(e,0)};return window.addEventListener("voiceLineFilterChange",t),()=>{window.removeEventListener("voiceLineFilterChange",t)}}},[]),l)return(0,n.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}),(0,n.jsx)("span",{className:"ml-3 text-gray-400",children:"Loading voice lines..."})]});if(c)return(0,n.jsxs)("div",{className:"bg-red-900/30 border border-red-700 rounded-lg p-6 text-center",children:[(0,n.jsx)("p",{className:"text-red-400 mb-2",children:"Error loading voice lines"}),(0,n.jsx)("p",{className:"text-gray-400 text-sm",children:c})]});if(!r||0===Object.keys(r).length)return(0,n.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 text-center",children:[(0,n.jsx)("p",{className:"text-gray-400 mb-2",children:"No voice lines data available"}),(0,n.jsx)("p",{className:"text-gray-500 text-sm",children:"Voice lines may still be loading or there might be an issue with the data source."}),(0,n.jsxs)("div",{className:"mt-4 p-4 bg-gray-900 rounded text-left text-xs text-gray-400 overflow-auto max-h-60",children:[(0,n.jsxs)("p",{children:["Character name: ",t]}),(0,n.jsxs)("p",{children:["Voice lines data available: ",r?"Yes":"No"]}),(0,n.jsxs)("p",{children:["Voice lines keys: ",r?Object.keys(r).join(", "):"None"]}),(0,n.jsxs)("p",{children:["Selected characters: ",y.join(", ")||"None"]}),(0,n.jsxs)("p",{children:["Selected categories: ",g.join(", ")||"None"]})]})]});let F=(0,a.Kg)(r,t),_=(0,a.qJ)(r,t),J=(0,s.useMemo)(()=>{if(console.log("VoiceLinesSection - Filtering voice lines about with characters:",y),!r||0===Object.keys(r).length||!F||0===Object.keys(F).length)return console.log("VoiceLinesSection - No voice lines data available for filtering"),{};let e={},t=y.length>0?y:Object.keys(F);return console.log("VoiceLinesSection - Characters to include:",t),t.forEach(t=>{F[t]&&(e[t]=F[t])}),console.log("VoiceLinesSection - Filtered voice lines about result keys:",Object.keys(e)),e},[F,y,r]),M=(0,s.useMemo)(()=>{if(console.log("VoiceLinesSection - Filtering voice lines by with characters:",y),!r||0===Object.keys(r).length||!_||0===Object.keys(_).length)return console.log("VoiceLinesSection - No voice lines data available for filtering"),{};let e={},t=y.length>0?y:Object.keys(_);return console.log("VoiceLinesSection - Characters to include:",t),t.forEach(t=>{_[t]&&(e[t]=_[t])}),console.log("VoiceLinesSection - Filtered voice lines by result keys:",Object.keys(e)),e},[_,y,r]),T=(e,t)=>{let r=[];console.log('Extracting audio files for character "'.concat(e,'" from ').concat(t," tab..."));try{if("about"===t&&J[e]){let t=J[e];Object.entries(t).forEach(e=>{let[t,n]=e;(0===g.length||g.includes(t))&&(console.log("Processing category: ".concat(t)),Array.isArray(n)?n.forEach(e=>{e&&e.filename&&r.push(e.filename)}):"object"==typeof n&&null!==n&&("filename"in n&&"string"==typeof n.filename?r.push(n.filename):Object.entries(n).forEach(e=>{let[t,n]=e;Array.isArray(n)?n.forEach(e=>{e&&e.filename&&r.push(e.filename)}):"object"==typeof n&&null!==n&&"filename"in n&&r.push(n.filename)})))})}else if("by"===t&&M[e]){let t=M[e];Object.entries(t).forEach(e=>{let[t,n]=e;(0===g.length||g.includes(t))&&(console.log("Processing category: ".concat(t)),Array.isArray(n)?n.forEach(e=>{e&&e.filename&&r.push(e.filename)}):"object"==typeof n&&null!==n&&("filename"in n&&"string"==typeof n.filename?r.push(n.filename):Object.entries(n).forEach(e=>{let[t,n]=e;Array.isArray(n)?n.forEach(e=>{e&&e.filename&&r.push(e.filename)}):"object"==typeof n&&null!==n&&"filename"in n&&r.push(n.filename)})))})}if(console.log("Extracted ".concat(r.length,' audio files for character "').concat(e,'"')),r.length>0){let e=Math.min(5,r.length);console.log("First ".concat(e," files in playlist:"),r.slice(0,e))}}catch(t){console.error('Error extracting audio files for character "'.concat(e,'":'),t)}return r},R=(e,t,r)=>{let n=[];console.log('Extracting audio files for character "'.concat(e,'" and category "').concat(t,'" from ').concat(r," tab..."));try{if("about"===r&&J[e]){let r=J[e];if(r[t]){let e=r[t];Array.isArray(e)?e.forEach(e=>{e&&e.filename&&n.push(e.filename)}):"object"==typeof e&&null!==e&&("filename"in e&&"string"==typeof e.filename?n.push(e.filename):Object.entries(e).forEach(e=>{let[t,r]=e;Array.isArray(r)?r.forEach(e=>{e&&e.filename&&n.push(e.filename)}):"object"==typeof r&&null!==r&&"filename"in r&&n.push(r.filename)}))}}else if("by"===r&&M[e]){let r=M[e];if(r[t]){let e=r[t];Array.isArray(e)?e.forEach(e=>{e&&e.filename&&n.push(e.filename)}):"object"==typeof e&&null!==e&&("filename"in e&&"string"==typeof e.filename?n.push(e.filename):Object.entries(e).forEach(e=>{let[t,r]=e;Array.isArray(r)?r.forEach(e=>{e&&e.filename&&n.push(e.filename)}):"object"==typeof r&&null!==r&&"filename"in r&&n.push(r.filename)}))}}if(console.log("Extracted ".concat(n.length,' audio files for character "').concat(e,'" and category "').concat(t,'"')),n.length>0){let e=Math.min(5,n.length);console.log("First ".concat(e," files in playlist:"),n.slice(0,e))}}catch(r){console.error('Error extracting audio files for character "'.concat(e,'" and category "').concat(t,'":'),r)}return n},B=(e,t,r)=>{try{if(I.current){console.log("Stopping playback of voice lines"),I.current=!1,b(!1),j(null),w(null),S.current&&(S.current.pause(),S.current.src="",S.current.onended=null,S.current.onerror=null),C(null);return}console.log('Extracting audio files for character "'.concat(e,'" and category "').concat(t,'"...'));let n=R(e,t,r);if(0===n.length){console.warn('No audio files found for character "'.concat(e,'" and category "').concat(t,'"')),alert("No voice lines found for ".concat(e," in the ").concat(t," category."));return}console.log("Starting playback of ".concat(n.length,' voice lines for character "').concat(e,'" and category "').concat(t,'"')),j(e),w(t),E.current=n,k.current=0,I.current=!0,b(!0),S.current||(S.current=new Audio),W()}catch(r){console.error('Error in playCategoryVoiceLines for "'.concat(e,'" and category "').concat(t,'":'),r),alert("Error playing voice lines: ".concat(r.message)),I.current=!1,b(!1),j(null),w(null),C(null)}},z=(e,t)=>{try{if(I.current){console.log("Stopping playback of voice lines"),I.current=!1,b(!1),j(null),w(null),S.current&&(S.current.pause(),S.current.src="",S.current.onended=null,S.current.onerror=null),C(null),A(!1);return}console.log('Extracting audio files for character "'.concat(e,'"...'));let r=T(e,t);if(0===r.length){console.warn('No audio files found for character "'.concat(e,'"')),alert("No voice lines found for ".concat(e," with the current filters."));return}console.log("Starting playback of ".concat(r.length,' voice lines for character "').concat(e,'"')),j(e),w(null),E.current=r,k.current=0,I.current=!0,b(!0),S.current||(S.current=new Audio),W()}catch(t){console.error('Error in playCharacterVoiceLines for "'.concat(e,'":'),t),alert("Error playing voice lines: ".concat(t.message)),I.current=!1,b(!1),j(null),w(null),C(null)}},W=()=>{try{if(!I.current||!E.current||0===E.current.length){console.log("Cannot play current audio: playback not active or no audio files");return}let e=E.current[k.current];console.log("Playing voice line (".concat(k.current+1,"/").concat(E.current.length,"): ").concat(e)),S.current||(S.current=new Audio),S.current.onended=null,S.current.onerror=null,S.current.onended=()=>{console.log("Audio ended: ".concat(e)),K()},S.current.onerror=()=>{console.error("Error playing audio ".concat(e)),K()},S.current.src="/audioFiles/".concat(e),C(e);let t=S.current.play();void 0!==t&&t.catch(t=>{console.error("Error playing audio ".concat(e,":"),t),K()})}catch(e){console.error("Error in playCurrentAudio:",e),K()}},K=()=>{try{if(!I.current){console.log("Cannot move to next audio: playback not active");return}if(k.current++,k.current>=E.current.length){console.log("Reached the end of the playlist"),I.current=!1,b(!1),j(null),w(null),C(null);return}W()}catch(e){console.error("Error in moveToNextAudio:",e),I.current=!1,b(!1),j(null),w(null),C(null)}},q=e=>{I.current&&(console.log("Stopping ongoing playback because individual voice line was played"),I.current=!1,b(!1),j(null),w(null),S.current&&(S.current.pause(),S.current.src="",S.current.onended=null,S.current.onerror=null)),C(e)},D=e=>{L===e&&C(null)},G=(0,n.jsxs)("div",{className:"mb-4 p-4 bg-gray-800 rounded text-xs text-gray-400 overflow-auto max-h-60",children:[(0,n.jsxs)("p",{children:["Character name: ",t]}),(0,n.jsxs)("p",{children:["Voice lines about keys: ",Object.keys(F).join(", ")||"None"]}),(0,n.jsxs)("p",{children:["Voice lines by keys: ",Object.keys(_).join(", ")||"None"]}),(0,n.jsxs)("p",{children:["Selected characters: ",y.join(", ")||"None"]}),(0,n.jsxs)("p",{children:["Selected categories: ",g.join(", ")||"None"]}),(0,n.jsxs)("p",{children:["Filtered voice lines about keys: ",Object.keys(J).join(", ")||"None"]}),(0,n.jsxs)("p",{children:["Filtered voice lines by keys: ",Object.keys(M).join(", ")||"None"]})]});return(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsxs)("div",{className:"flex border-b border-gray-700 mb-4",children:[(0,n.jsxs)("button",{className:"px-4 py-2 font-medium ".concat("about"===h?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-300"),onClick:()=>{m("about"),f([]),sessionStorage.setItem("voiceLineFilterTab","about"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("voiceLineTabChange",{detail:"about"}))},0)},children:["Spoken By ",(0,i.v)(t)]}),(0,n.jsxs)("button",{className:"px-4 py-2 font-medium ".concat("by"===h?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-300"),onClick:()=>{m("by"),f([]),sessionStorage.setItem("voiceLineFilterTab","by"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("voiceLineTabChange",{detail:"by"}))},0)},children:["Lines About ",(0,i.v)(t)]})]}),(0,n.jsx)("div",{className:"p-4",children:"about"===h?(0,n.jsx)(d,{voiceLines:J,selectedCategory:1===g.length?g[0]:null,currentPlayingFile:L,onVoiceLinePlayed:q,onVoiceLinePaused:D,expandAll:O,characterName:t,isPlayingAll:x,currentPlayingCharacter:p,currentPlayingCategory:N,onPlayCharacter:e=>z(e,"about"),onPlayCategory:(e,t)=>B(e,t,"about")}):(0,n.jsx)(u,{voiceLines:M,characterName:t,selectedCategory:1===g.length?g[0]:null,currentPlayingFile:L,onVoiceLinePlayed:q,onVoiceLinePaused:D,expandAll:O,isPlayingAll:x,currentPlayingCharacter:p,currentPlayingCategory:N,onPlayCharacter:e=>z(e,"by"),onPlayCategory:(e,t)=>B(e,t,"by")})}),G]})};var m=r(5565),g=r(8173),f=r.n(g),x=r(71),b=r(6046),y=r(3116),v=r(2030);let p=e=>{let{characterName:t,voiceLines:r}=e,[l,o]=(0,s.useState)("about"),[c,i]=(0,s.useState)([]),[d,u]=(0,s.useState)([]),[h,m]=(0,s.useState)(!0);(0,s.useEffect)(()=>{console.log("VoiceLinesFilter - voiceLines data:",r?"available":"not available"),r&&console.log("VoiceLinesFilter - voiceLines keys:",Object.keys(r))},[r]);let g=(0,s.useMemo)(()=>r&&0!==Object.keys(r).length?(console.log("VoiceLinesFilter - voiceLines data keys:",Object.keys(r||{})),console.log("VoiceLinesFilter - characterName:",t),(0,a.Kg)(r,t)):(console.log("VoiceLinesFilter - No voice lines data available for voiceLinesAbout"),{}),[r,t]),f=(0,s.useMemo)(()=>r&&0!==Object.keys(r).length?(0,a.qJ)(r,t):(console.log("VoiceLinesFilter - No voice lines data available for voiceLinesBy"),{}),[r,t]),x=(0,s.useMemo)(()=>{let e=[];return"about"===l?d.length>0?Object.entries(g).forEach(t=>{let[r,n]=t;d.some(e=>!!n[e]&&(Array.isArray(n[e])?n[e].length>0:"object"==typeof n[e]&&Object.values(n[e]).some(e=>Array.isArray(e)&&e.length>0)))&&e.push(r)}):e=Object.keys(g):d.length>0?Object.entries(f).forEach(t=>{let[r,n]=t;d.some(e=>!!n[e]&&(Array.isArray(n[e])?n[e].length>0:"object"==typeof n[e]&&Object.values(n[e]).some(e=>Array.isArray(e)&&e.length>0)))&&e.push(r)}):e=Object.keys(f),e.sort()},[l,g,f,d]),b=(0,s.useMemo)(()=>{let e;let t=new Set;return Object.entries("about"===l?g:f).forEach(e=>{let[r,n]=e;(0===c.length||c.includes(r))&&Object.entries(n).forEach(e=>{let[r,n]=e;Array.isArray(n)&&n.length>0?t.add(r):"object"==typeof n&&null!==n&&Object.values(n).some(e=>Array.isArray(e)&&e.length>0)&&t.add(r)})}),Array.from(t).sort()},[l,g,f,c]),y=e=>{u(t=>{let r;return(r=t.includes(e)?t.filter(t=>t!==e):[...t,e]).length>0?sessionStorage.setItem("voiceLineFilterCategories",JSON.stringify(r)):sessionStorage.removeItem("voiceLineFilterCategories"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("voiceLineFilterChange"))},0),r})};return(0,s.useEffect)(()=>{{let e=sessionStorage.getItem("voiceLineFilterTab");e&&o(e),sessionStorage.removeItem("voiceLineFilterCharacters"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("voiceLineFilterChange"))},0);let t=sessionStorage.getItem("voiceLineFilterCategories");if(t)try{let e=JSON.parse(t);Array.isArray(e)&&u(e)}catch(e){console.error("Error parsing saved voice line filter categories:",e)}}},[]),(0,s.useEffect)(()=>{console.log("VoiceLinesFilter component mounted"),console.log("Initial voiceLines data:",r?Object.keys(r).length:"null"),console.log("Initial characterName:",t)},[]),(0,s.useEffect)(()=>{{let e=e=>{let t=e.detail;console.log("VoiceLinesFilter - Custom event received:",t),t&&t!==l&&(o(t),i([]),u([]))};return window.addEventListener("voiceLineTabChange",e),()=>{window.removeEventListener("voiceLineTabChange",e)}}},[l]),(0,n.jsxs)("div",{children:[(0,n.jsx)(v.A,{characters:x,selectedCharacters:c,onChange:e=>{console.log("VoiceLinesFilter - Character filter changed:",e),i(e),e.length>0?sessionStorage.setItem("voiceLineFilterCharacters",JSON.stringify(e)):sessionStorage.removeItem("voiceLineFilterCharacters"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("voiceLineFilterChange"))},0)},title:"Filter by Characters"}),(0,n.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center cursor-pointer mb-2",onClick:()=>m(!h),children:[(0,n.jsx)("h3",{className:"text-white font-medium",children:"Filter by Categories"}),(0,n.jsx)("svg",{className:"w-5 h-5 text-gray-400 transform ".concat(h?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),h&&(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("div",{className:"max-h-60 overflow-y-auto pr-1 space-y-1",children:b.length>0?b.map(e=>(0,n.jsxs)("div",{className:"flex items-center p-2 rounded cursor-pointer ".concat(d.includes(e)?"bg-blue-900 hover:bg-blue-800":"hover:bg-gray-700"),onClick:()=>y(e),children:[(0,n.jsx)("span",{className:"text-sm text-white",children:e}),d.includes(e)&&(0,n.jsx)("svg",{className:"w-4 h-4 ml-auto text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},e)):(0,n.jsx)("div",{className:"text-center py-4 text-gray-400",children:"No categories found"})}),d.length>0&&(0,n.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-700",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"text-sm text-gray-400",children:["Selected: ",d.length," category",1!==d.length?"ies":"y"]}),(0,n.jsx)("button",{onClick:()=>{u([]),sessionStorage.removeItem("voiceLineFilterCategories"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("voiceLineFilterChange"))},0)},className:"px-2 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700",children:"Clear Selection"})]})})]})]})]})},j="previousPath",N="selectedPartners",w="filtersCleared";function S(e){let{character:t,conversations:r}=e,[c,d]=(0,s.useState)(!0),[u,g]=(0,s.useState)([]),[S,k]=(0,s.useState)(0===r.length?"voicelines":"conversations"),[E,L]=(0,s.useState)([]),C=(0,b.usePathname)(),O=(0,b.useRouter)(),{voiceLines:A,data:V}=(0,o.E)(),P=A?(0,a.N3)(A,t.name):0,I=A?(0,a.Fc)(A,t.name):0;(0,s.useEffect)(()=>{{console.log("CharacterPageClient - voiceLines data:",A?"available":"not available"),A&&console.log("CharacterPageClient - voiceLines keys:",Object.keys(A));let e=()=>{sessionStorage.setItem(j,C)};if(window.addEventListener("beforeunload",e),"true"===sessionStorage.getItem(w))sessionStorage.removeItem(w);else{let e=sessionStorage.getItem(N);if(e)try{let r=JSON.parse(e);if(Array.isArray(r)){let e=r.filter(e=>t.conversationPartners.includes(e));g(e)}}catch(e){console.error("Error parsing selected partners:",e)}}return()=>{window.removeEventListener("beforeunload",e)}}},[C,t.conversationPartners,A]),(0,s.useEffect)(()=>{u.length>0?sessionStorage.setItem(N,JSON.stringify(u)):sessionStorage.removeItem(N)},[u]),(0,s.useEffect)(()=>{if(V&&V.conversations){let e=new Set;V.conversations.forEach(t=>{e.add(t.character1),e.add(t.character2)}),L(Array.from(e))}},[V]);let F=(0,i.v)(t.name);r.filter(e=>{if(!c&&!e.is_complete)return!1;if(u.length>0){let r=e.character1===t.name?e.character2:e.character1;return u.includes(r)}return!0});let _=e=>{let t=(0,x.h)(e);return"/minimapIcons/".concat(t,"_mm_psd.png")},J=e=>{g(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},M=e=>{sessionStorage.setItem(j,C),u.length>0?sessionStorage.setItem(N,JSON.stringify(u)):sessionStorage.removeItem(N),window.location.href="/conversations/".concat(encodeURIComponent(e))},T=(0,s.useMemo)(()=>{let e=[...r];return u.length>0&&(e=e.filter(e=>{let r=e.character1===t.name?e.character2:e.character1;return u.includes(r)})),c||(e=e.filter(e=>e.is_complete)),e.sort((e,t)=>e.conversation_id.localeCompare(t.conversation_id))},[r,u,c,t.name]);return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsxs)(f(),{href:"/",className:"inline-flex items-center text-blue-400 hover:underline",onClick:()=>{sessionStorage.setItem(j,"/"),sessionStorage.removeItem(N),sessionStorage.setItem(w,"true")},children:[(0,n.jsx)("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),"Back to Home"]}),(0,n.jsxs)("button",{onClick:()=>{sessionStorage.setItem(j,"/conversations"),sessionStorage.removeItem(N),sessionStorage.setItem(w,"true"),O.push("/conversations")},className:"inline-flex items-center text-blue-400 hover:underline bg-transparent border-none cursor-pointer",children:[(0,n.jsx)("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Go to Search"]})]})}),(0,n.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 mb-8",children:[(0,n.jsx)("div",{className:"w-full md:w-1/3 lg:w-1/4 md:h-screen md:sticky md:top-0 md:self-start",children:(0,n.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 overflow-y-auto h-auto md:max-h-[calc(100vh-2rem)] md:my-4",children:[(0,n.jsx)("div",{className:"relative w-32 h-32 mx-auto mb-4",children:(0,n.jsx)(m.default,{src:_(t.name),alt:"".concat(F," portrait"),fill:!0,sizes:"128px",className:"object-cover rounded-full",onError:e=>{e.target.src="/minimapIcons/genericperson_mm_psd.png"}})}),(0,n.jsx)("h1",{className:"text-2xl font-bold text-white text-center mb-4",children:F}),"voicelines"===S&&(0,n.jsxs)("div",{className:"bg-gray-700 rounded-lg p-3 mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-300 mb-2",children:"Voice Line Stats"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-center",children:[(0,n.jsxs)("div",{className:"bg-gray-800 rounded p-2",children:[(0,n.jsx)("div",{className:"text-xl font-bold text-blue-400",children:P}),(0,n.jsxs)("div",{className:"text-xs text-gray-400",children:["By ",F]})]}),(0,n.jsxs)("div",{className:"bg-gray-800 rounded p-2",children:[(0,n.jsx)("div",{className:"text-xl font-bold text-blue-400",children:I}),(0,n.jsxs)("div",{className:"text-xs text-gray-400",children:["About ",F]})]})]})]}),(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsxs)("div",{className:"flex border-b border-gray-700 mb-4",children:[(0,n.jsx)("button",{className:"px-4 py-2 font-medium ".concat("conversations"===S?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-300"),onClick:()=>k("conversations"),children:"Conversations"}),(0,n.jsx)("button",{className:"px-4 py-2 font-medium ".concat("voicelines"===S?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-300"),onClick:()=>k("voicelines"),children:"Voice Lines"})]}),"conversations"===S&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.A,{characters:t.conversationPartners,selectedCharacters:u,onChange:e=>{g(e)},title:"Filter by Partners"}),(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsxs)("label",{className:"flex items-center text-white cursor-pointer",children:[(0,n.jsx)("input",{type:"checkbox",checked:c,onChange:()=>d(!c),className:"mr-2 h-4 w-4"}),"Show Incomplete Conversations"]})}),(0,n.jsx)("div",{className:"mt-4 pb-4",children:(0,n.jsx)("button",{onClick:()=>{(0,y.B2)(t.name,r),window.location.reload()},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Reset Viewed Conversations"})})]}),"voicelines"===S&&(0,n.jsx)(n.Fragment,{children:A?(0,n.jsx)(p,{characterName:t.name,voiceLines:A}):(0,n.jsx)("div",{className:"bg-gray-700 rounded-lg p-4 text-center text-gray-300",children:"Voice line data is loading or unavailable"})})]})]})}),(0,n.jsx)("div",{className:"w-full md:w-2/3 lg:w-3/4",children:"conversations"===S?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("h2",{className:"text-xl font-bold text-white mb-4",children:[u.length>0?"Conversations with ".concat(1===u.length?(0,i.v)(u[0]):"".concat(u.length," characters")):"All Conversations",(0,n.jsxs)("span",{className:"ml-2 text-sm font-normal text-gray-400",children:["(",T.length," ",1===T.length?"conversation":"conversations",")"]})]}),u.length>1&&(0,n.jsxs)("div",{className:"mb-4 flex flex-wrap gap-2 items-center",children:[(0,n.jsx)("span",{className:"text-gray-300",children:"Filtered by:"}),u.map(e=>(0,n.jsxs)("span",{className:"px-3 py-1 bg-blue-800 text-white rounded-full text-sm flex items-center",children:[(0,n.jsx)("div",{className:"relative w-4 h-4 mr-1",children:(0,n.jsx)(m.default,{src:_(e),alt:"".concat((0,i.v)(e)," portrait"),fill:!0,sizes:"16px",className:"object-cover rounded-full",onError:e=>{e.target.src="/minimapIcons/genericperson_mm_psd.png"}})}),(0,i.v)(e),(0,n.jsx)("button",{onClick:()=>J(e),className:"ml-2 text-white hover:text-gray-200",children:(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]},e))]}),T.length>0?(0,n.jsx)("div",{className:"grid grid-cols-1 gap-4",children:T.map(e=>(0,n.jsx)(l.A,{conversation:e,highlightCharacter:t.name,onClick:()=>M(e.conversation_id)},e.conversation_id))}):(0,n.jsx)("div",{className:"text-center py-8 bg-gray-800 rounded-lg",children:(0,n.jsx)("p",{className:"text-gray-400",children:"No conversations found matching your criteria."})})]}):(0,n.jsx)(h,{characterName:t.name})})]})]})}},9232:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(5155),s=r(2115),l=r(5565),o=r(4957),a=r(71),c=r(3116);let i=e=>{let{conversation:t,highlightCharacter:r,onClick:i}=e,{conversation_id:d,character1:u,character2:h,is_complete:m,missing_parts:g,summary:f,lines:x}=t,[b,y]=(0,s.useState)(!1);(0,s.useEffect)(()=>{y((0,c.yV)(d))},[d]);let v=r?u===r?h:u:null,p=(0,o.v)(u),j=(0,o.v)(h),N=v?(0,o.v)(v):null,w=v?"Conversation with ".concat(N):"".concat(p," & ").concat(j),S=f||(x.length>0?x[0].transcription:"No preview available"),k=e=>{let t=(0,a.h)(e);return"/minimapIcons/".concat(t,"_mm_psd.png")};return(0,n.jsx)("div",{className:"\n        bg-gray-800 rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300 p-4 mb-4 \n        ".concat(m?"":"border-l-4 border-yellow-600"," \n        ").concat(b?"opacity-70 bg-gray-900":""," \n        ").concat(i?"cursor-pointer hover:bg-gray-750":"","\n      "),onClick:i,role:i?"button":void 0,tabIndex:i?0:void 0,onKeyDown:e=>{i&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),i())},children:(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("div",{className:"flex-shrink-0 mr-4",children:r&&v?(0,n.jsx)("div",{className:"relative w-12 h-12",children:(0,n.jsx)(l.default,{src:k(v),alt:"".concat(N," portrait"),fill:!0,sizes:"48px",className:"object-cover rounded-full ".concat(b?"opacity-70":""),onError:e=>{e.target.src="/minimapIcons/genericperson_mm_psd.png"}})}):(0,n.jsxs)("div",{className:"flex -space-x-3",children:[(0,n.jsx)("div",{className:"relative w-12 h-12 z-10",children:(0,n.jsx)(l.default,{src:k(u),alt:"".concat(p," portrait"),fill:!0,sizes:"48px",className:"object-cover rounded-full border-2 border-gray-800 ".concat(b?"opacity-70":""),onError:e=>{e.target.src="/minimapIcons/genericperson_mm_psd.png"}})}),(0,n.jsx)("div",{className:"relative w-12 h-12 z-0",children:(0,n.jsx)(l.default,{src:k(h),alt:"".concat(j," portrait"),fill:!0,sizes:"48px",className:"object-cover rounded-full border-2 border-gray-800 ".concat(b?"opacity-70":""),onError:e=>{e.target.src="/minimapIcons/genericperson_mm_psd.png"}})})]})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-white",children:w}),(0,n.jsx)("p",{className:"text-gray-400 text-sm mt-1 line-clamp-3",children:S}),(0,n.jsxs)("div",{className:"flex items-center mt-2",children:[!m&&(0,n.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-800 text-yellow-100 mr-2",children:"Incomplete"}),g.length>0&&(0,n.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-800 text-red-100",children:["Missing parts: ",g.join(", ")]}),b&&(0,n.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-800 text-blue-100 ml-auto",children:"Viewed"})]})]})]})})}}}]);